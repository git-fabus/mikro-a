\NeedsTeXFormat{LaTeX2e}[1994/06/01]
\ProvidesPackage{libertikz}[2021/04/11 v0.1 Libertinus looking arrows for TikZ]

\RequirePackage{tikz}
\usetikzlibrary{arrows.meta}





%%%%% REGULAR ARROW TIP

%reconstruct the libertine arrow tip for tikz(cd)
%See TikZ manual, section "Defining New Arrow Tips"
\pgfdeclarearrow{%
	name = {Libertinus Regular},
	parameters = { \the\pgfarrowlength },
	setup code = {%
		% The different end values
		\pgfarrowssettipend{0.382\pgfarrowlength}
		\pgfarrowssetlineend{0\pgfarrowlength}
		\pgfarrowssetvisualbackend{-0.134\pgfarrowlength}
		\pgfarrowssetbackend{-0.618\pgfarrowlength}
		% The convex hull
		\pgfarrowshullpoint{0.382\pgfarrowlength}{0.037\pgfarrowlength}
		\pgfarrowshullpoint{-0.493\pgfarrowlength}{0.726\pgfarrowlength}
		\pgfarrowshullpoint{-0.618\pgfarrowlength}{0.726\pgfarrowlength}
		\pgfarrowshullpoint{-0.618\pgfarrowlength}{-0.726\pgfarrowlength}
		\pgfarrowshullpoint{-0.493\pgfarrowlength}{-0.726\pgfarrowlength}
		\pgfarrowshullpoint{0.382\pgfarrowlength}{0.037\pgfarrowlength}
		% Saves: Only the length:
		\pgfarrowssavethe\pgfarrowlength
	},
	% the following coordinates are choosen so that the
	% arrow head has a length parallel to the x-axis
	% of precisely 1pt
	drawing code = {%
		\pgfpathmoveto%
			{\pgfpoint{0.370\pgfarrowlength}{0.046\pgfarrowlength}}
		\pgfpathcurveto%
			{\pgfpoint{0.18\pgfarrowlength}{0.11\pgfarrowlength}}%
			{\pgfpoint{-0.13\pgfarrowlength}{0.33\pgfarrowlength}}%
			{\pgfpoint{-0.470\pgfarrowlength}{0.708\pgfarrowlength}}
		\pgfpathcurveto%
			{\pgfpoint{-0.49\pgfarrowlength}{0.73\pgfarrowlength}}%
			{\pgfpoint{-0.59\pgfarrowlength}{0.73\pgfarrowlength}}%
			{\pgfpoint{-0.618\pgfarrowlength}{0.708\pgfarrowlength}}
		\pgfpathcurveto%
			{\pgfpoint{-0.50\pgfarrowlength}{0.43\pgfarrowlength}}%
			{\pgfpoint{-0.19\pgfarrowlength}{0.07\pgfarrowlength}}%
			{\pgfpoint{-0.100\pgfarrowlength}{0.000\pgfarrowlength}}
		\pgfpathcurveto%
			{\pgfpoint{-0.19\pgfarrowlength}{-0.07\pgfarrowlength}}%
			{\pgfpoint{-0.50\pgfarrowlength}{-0.43\pgfarrowlength}}%
			{\pgfpoint{-0.618\pgfarrowlength}{-0.708\pgfarrowlength}}
		\pgfpathcurveto%
			{\pgfpoint{-0.59\pgfarrowlength}{-0.73\pgfarrowlength}}%
			{\pgfpoint{-0.49\pgfarrowlength}{-0.73\pgfarrowlength}}%
			{\pgfpoint{-0.470\pgfarrowlength}{-0.708\pgfarrowlength}}
		\pgfpathcurveto%
			{\pgfpoint{-0.13\pgfarrowlength}{-0.33\pgfarrowlength}}%
			{\pgfpoint{0.18\pgfarrowlength}{-0.11\pgfarrowlength}}%
			{\pgfpoint{0.370\pgfarrowlength}{-0.046\pgfarrowlength}}
		\pgfpathcurveto%
			{\pgfpoint{0.39\pgfarrowlength}{-0.03\pgfarrowlength}}%
			{\pgfpoint{0.39\pgfarrowlength}{0.03\pgfarrowlength}}%
			{\pgfpoint{0.370\pgfarrowlength}{0.046\pgfarrowlength}}
		\pgfpathclose
		\pgfusepathqfill
	},
	defaults = { length = 2.605pt }
}

\tikzset{
	> = {Libertinus Regular},
}

\tikzcdset{
	arrow style = tikz,
	arrows = {line width  = 0.8 * rule_thickness}
}





%%%%% IMPLICATION ARROWS

% The code below is copy-pasted from the previous one, but
% has been slighty adjusted:
%
% - The default size is slithly larger
%
% - The bounding box of the tip is slithly enlarged to
%   ensure that the two lines of the arrow donâ€™t cross over
%   the arrow tip

\pgfdeclarearrow{%
	name = {Libertinus Implies},
	parameters = { \the\pgfarrowlength },
	setup code = {%
		% The different end values
		\pgfarrowssettipend{0.382\pgfarrowlength}
		\pgfarrowssetlineend{-0.150\pgfarrowlength}
		\pgfarrowssetvisualbackend{-0.134\pgfarrowlength}
		\pgfarrowssetbackend{-0.618\pgfarrowlength}
		% The convex hull
		\pgfarrowshullpoint{0.382\pgfarrowlength}{0.037\pgfarrowlength}
		\pgfarrowshullpoint{-0.493\pgfarrowlength}{0.726\pgfarrowlength}
		\pgfarrowshullpoint{-0.618\pgfarrowlength}{0.726\pgfarrowlength}
		\pgfarrowshullpoint{-0.618\pgfarrowlength}{-0.726\pgfarrowlength}
		\pgfarrowshullpoint{-0.493\pgfarrowlength}{-0.726\pgfarrowlength}
		\pgfarrowshullpoint{0.382\pgfarrowlength}{0.037\pgfarrowlength}
		% Saves: Only the length:
		\pgfarrowssavethe\pgfarrowlength
	},
	% the following coordinates are choosen so that the
	% arrow head has a length parallel to the x-axis
	% of precisely 1pt
	drawing code = {%
		\pgfpathmoveto%
			{\pgfpoint{0.370\pgfarrowlength}{0.046\pgfarrowlength}}
		\pgfpathcurveto%
			{\pgfpoint{0.18\pgfarrowlength}{0.11\pgfarrowlength}}%
			{\pgfpoint{-0.13\pgfarrowlength}{0.33\pgfarrowlength}}%
			{\pgfpoint{-0.470\pgfarrowlength}{0.708\pgfarrowlength}}
		\pgfpathcurveto%
			{\pgfpoint{-0.49\pgfarrowlength}{0.73\pgfarrowlength}}%
			{\pgfpoint{-0.59\pgfarrowlength}{0.73\pgfarrowlength}}%
			{\pgfpoint{-0.618\pgfarrowlength}{0.708\pgfarrowlength}}
		\pgfpathcurveto%
			{\pgfpoint{-0.50\pgfarrowlength}{0.43\pgfarrowlength}}%
			{\pgfpoint{-0.19\pgfarrowlength}{0.07\pgfarrowlength}}%
			{\pgfpoint{-0.100\pgfarrowlength}{0.000\pgfarrowlength}}
		\pgfpathcurveto%
			{\pgfpoint{-0.19\pgfarrowlength}{-0.07\pgfarrowlength}}%
			{\pgfpoint{-0.50\pgfarrowlength}{-0.43\pgfarrowlength}}%
			{\pgfpoint{-0.618\pgfarrowlength}{-0.708\pgfarrowlength}}
		\pgfpathcurveto%
			{\pgfpoint{-0.59\pgfarrowlength}{-0.73\pgfarrowlength}}%
			{\pgfpoint{-0.49\pgfarrowlength}{-0.73\pgfarrowlength}}%
			{\pgfpoint{-0.470\pgfarrowlength}{-0.708\pgfarrowlength}}
		\pgfpathcurveto%
			{\pgfpoint{-0.13\pgfarrowlength}{-0.33\pgfarrowlength}}%
			{\pgfpoint{0.18\pgfarrowlength}{-0.11\pgfarrowlength}}%
			{\pgfpoint{0.370\pgfarrowlength}{-0.046\pgfarrowlength}}
		\pgfpathcurveto%
			{\pgfpoint{0.39\pgfarrowlength}{-0.03\pgfarrowlength}}%
			{\pgfpoint{0.39\pgfarrowlength}{0.03\pgfarrowlength}}%
			{\pgfpoint{0.370\pgfarrowlength}{0.046\pgfarrowlength}}
		\pgfpathclose
		\pgfusepathqfill
	},
	defaults = { length = 2.83pt }
}

\tikzcdset{
	tikzcd implies/.tip = {Libertinus Implies},
	% Adjust the distance between the two lines: By default,
	% tikz takes this value from the equality sign. But for
	% Libertinus, the lines in \Rightarrow etc. are closer
	% together than for the equality sign the value of 1.51
	% was determined by trial and error
	double line/.append style = {double distance = 1.51*rule_thickness}
}





% EQUAL SIGN

% By default, tikz-cd uses 'double line' to control the
% distances of the two lines. But in Libertinus the equal
% sign needs a larger distance. We therefore introduce a
% new version of 'double line' for the 'equal' arrow in
% tikzcd. (The code is copied from 'tikz-cd'.)

\tikzcdset{
	double equal line/.code={\tikzset{%
	double equal sign distance,
	double=\pgfkeysvalueof{/tikz/commutative diagrams/background color}}},
	equal/.code={\tikzcdset{double equal line}\pgfsetarrows{tikzcd implies cap-tikzcd implies cap}},
	double equal line/.append style = {double distance = 2.3*rule_thickness}
}





%%%%% MAPSTO WITH ONE LINE

% The side of the bar for \mapsto & Co. needs to be
% adjusted to Libertinus.

\tikzcdset{
	tikzcd bar/.tip={Bar[width=+1.74pt 4 0.9]},
}
